{% extends 'base.html' %}
{% load static %}
<title>{% block title %} View| Installments {% endblock %}</title>

{% block content %}


  <div class="wrapper">
  
      <!-- Navbar -->
      <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
              <a class="nav-link"
               data-widget="pushmenu" 
               href="#" role="button">
               <i class="fas fa-bars"></i>
              </a>
            </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="#"
              role="button"
              id="dark-mode-toggle"
              onclick="toggleDarkMode()"
            >
              <i class="fa-solid fa-moon"></i>
            </a>
          </li>
        
        </ul>
      </nav>

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="{% url 'adminPanel' %}" class="brand-link">
        <img
        src="{% static 'dist/img/user.png' %}"
          class="brand-image img-circle elevation-3"
          alt="User Image"
          style="opacity: 0.8"
        />
        <span class="brand-text font-weight-light">Admin</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul
            class="nav nav-pills nav-sidebar flex-column"
            data-widget="treeview"
            role="menu"
            data-accordion="false"
          >
           
            <li class="nav-item has-treeview menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-tachometer-alt"></i>
                <p>
                  Dashboard
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="{% url 'adminPanel' %}" class="nav-link">
                    <i
                      class="fa-regular fa-eye"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Overview</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'viewPartners' %}" class="nav-link">
                    <i
                      class="fa-solid fa-users"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Partners</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'viewStaffs' %}" class="nav-link">
                    <i
                      class="fa-solid fa-user-tie"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Admins</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'viewYouth' %}" class="nav-link ">
                    <i
                      class="fa-solid fa-restroom"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Youth</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'viewProjects' %}" class="nav-link">
                    <i
                      class="fa-solid fa-diagram-project"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Projects</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'viewOpportunities' %}" class="nav-link ">
                    <i
                      class="fa-solid fa-seedling"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Opportunities</p>
                  </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'viewInstallments' %}" class="nav-link active">
                      <i
                        class="fa-solid fa-seedling"
                        style="margin: 0 4px 0 0px"
                      ></i>
                      <p>Installments</p>
                    </a>
                  </li>
                <li class="nav-item">
                  <a href="{% url 'viewTeams' %}" class="nav-link ">
                    <i
                      class="fa-brands fa-teamspeak"
                      style="margin: 0 4px 0 0px"
                    ></i>
                    <p>Teams</p>
                  </a>
                  
                </li>
                <li class="nav-item">
                  <a href="{% url 'logout' %}" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z"/>
                      <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                    </svg>
                    <p>logout</p>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>Installments</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="">Home</a></li>
                <li class="breadcrumb-item active">Add Installment</li>
              </ol>
            </div>
          </div>
        </div>
        <!-- /.container-fluid -->
      </section>

      <!-- Main content -->
      <section class="content">
        <div class="row">
          <div class="col-12">
            <div class="card">
                <div class="card-header">
                  <div class="float-right">
                    <button
                    
                    class="btn btn-block btn-info btn-md"
                  
                    >
                    <span style="margin-right: 2px;"><i class="fa-solid fa-plus"></i></span>
                      <a href="" class="text-white"
                      data-toggle="modal"
                      data-target="#fundProjectModal"
                        > New Insatllmenst </a
                      >
                    </button>
                  </div>
                </div>
                <!-- /.card-header -->
                <div class="card-body">
                  <table id="example1" class="table table-bordered table-striped">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Project Name</th>
                        <th>Payment Ref</th>
                        <th>Installment Phase</th>
                        <th>Project cost</th>
                        <th>Paid Ammount</th>
                        <th>Remain Ammount</th>
                        <th>Status</th>
                        <th>Action</th>

                      </tr>
                    </thead>
                   
                    <tbody>
                      {% for installment in installments %}
                      <tr>
                        <td>{{ installment.id }}</td>
                        <td>{{ installment.projectName }}</td>
                        <td>{{ installment.payment_Ref }}</td>
                        <td>{{ installment.total_installments }}</td>
                        <td>{{ installment.projectCost }}</td>
                        <td>{{ installment.paid}}</td>
                        <td>{{ installment.remainAmount}}</td>
                        <td>{{ installment.status }}</td>
                        <td class="justify-content-center">
                          <a
                            href=""
                            data-id="1"
                            data-name="dumy"
                            data-ref="hByt45hsyrRT"
                            data-phase="3"

                            class="btn btn-success btn-sm edit-btn"
                          >
                            <i class="fas fa-pen"></i> Edit
                          </a>
                          <a href="" class="btn btn-danger btn-sm delete-btn" 
                          data-toggle="modal"
                           data-target="#deleteModal"
                           data-id="{{ installment.id }}"
                          >
                            <i class="fas fa-trash"></i> Delete
                        </a>
                        
                        </td>
                      </tr>
                      {% endfor %}

                    </tbody>
                  
                    <tfoot></tfoot>
                  </table>
                </div>
                <!-- /.card-body -->
              </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <!--Add installment modal-->

     <div class="modal fade" id="fundProjectModal" tabindex="-1" role="dialog" aria-labelledby="fundProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="fundProjectModalLabel">Add Installments</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="fundProjectForm" method="POST" action="">
                {% csrf_token %}
                <div class="form-group">
                  <label for="projectName">Project Name</label>
                  <select class="form-control" id="projectId" name="projectId" required>
                    <option value="">Select a project</option>
                    {% for project in projects %}
                    <option value="{{ project.id }}">{{ project.name }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="form-group">
                    <label for="partnerName">Parter Name</label>
                    <select class="form-control" id="partnerId" name="partnerId" required>
                      <option value="">Select a  partner</option>
                      {% for partner  in partners %}
                      <option value="{{ partner.id }}">{{ partner.name }}</option>
                      {% endfor %}
                    </select>
                  </div>
                
                <div class="form-group">
                  <label for="installments">Number of Installments</label>
                  <input type="number" class="form-control" id="installments" name="installments" min="1" required  max="4">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary" form="fundProjectForm">Save changes</button>
            </div>
          </div>
        </div>
      </div>
  
      

    <!-- Delete Modal -->
    <div
      class="modal fade"
      id="deleteModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="deleteModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this record?</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-danger" id="confirmDelete" >
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- /.modal -->

    <footer class="main-footer">
      <div class="float-right d-none d-sm-block"><b>2023</b></div>
      <strong>Copyright &copy; Dar es salaam regional commission.</strong>
      All rights reserved.
    </footer>

  
    <!-- /.control-sidebar -->
  </div>

  <script>
    
    $(function (){
      
      $("#example1").DataTable({
        responsive: true,
        autoWidth: false,
      });
      $("#example2").DataTable({
        paging: true,
        lengthChange: false,
        searching: true,
        ordering: true,
        info: true,
        autoWidth: false,
        responsive: true,
      });
      // Handle delete button click
      $(".delete-btn").click(function () {
      console.log("hello 1")
        var rowData = $(this).closest("tr").find("td:first").text();
        var id = rowData.trim();

        $("#confirmDelete").data("id", id);
      });

      $("#confirmDelete").click(function () {
        var id = $(this).data("id");

        console.log("Deleting obeject with ID: " + id);

        $.ajax({
          url: "{% url 'deleteOpportunityById' %}",
          type: "POST",
          data: {
            id: id,
            csrfmiddlewaretoken: "{{ csrf_token }}",
          },
          success: function (response) {
            window.location.reload();
          },
          error: function (xhr, status, error) {
            var errorMsg = xhr.responseJSON && xhr.responseJSON.message ? xhr.responseJSON.message : "Failed to delete user!";
                toastr.error(errorMsg);
                window.location.reload();
          },
        });

        $("#deleteModal").modal("hide");
      });
    });
  </script>
     {% if messages %}
   
     <script>
       var messages = [];
     </script>
     {% for message in messages %}
     <script>
       messages.push({
         "message": "{{ message.message }}",
         "tag": "{{ message.tags }}"
       });
     </script>
     {% endfor %}
   {% endif %}
   
   <script>
   $(function(){
     messages.forEach(function(message) {
       if (message.tag === "success") {
         toastr.success(message.message);
       } else if (message.tag=== "error") {
         toastr.error(message.message); 
       } else {
         toastr.info(message.message);
       }
     });
   });
   </script>

  {% endblock %}

