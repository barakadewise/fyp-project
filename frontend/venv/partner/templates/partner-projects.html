{% extends 'base.html' %}
{% load static %}
<title>{% block title %} View | Projects {% endblock %}</title>

{% block content %}

<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button">
          <i class="fas fa-bars"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" role="button" id="dark-mode-toggle" onclick="toggleDarkMode()">
          <i class="fa-solid fa-moon"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="{% url 'partnerDashboard' %}" class="brand-link">
      <img src="{% static 'dist/img/user.png' %}" class="brand-image img-circle elevation-3" alt="User Image" style="opacity: 0.8" />
      <span class="brand-text font-weight-light">Partner</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item has-treeview menu-open">
            <a href="#" class="nav-link active">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Dashboard
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="{% url 'partnerDashboard' %}" class="nav-link">
                  <i class="fa-regular fa-eye" style="margin: 0 4px 0 0px"></i>
                  <p>Overview</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{% url 'partnerViewProject' %}" class="nav-link active">
                  <i class="fa-solid fa-diagram-project" style="margin: 0 4px 0 0px"></i>
                  <p>Projects</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="{% url 'partnerViewOpportunities' %}" class="nav-link">
                  <i class="fa-solid fa-seedling" style="margin: 0 4px 0 0px"></i>
                  <p>Opportunities</p>
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Projects</h1>
          </div>
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="{% url 'partnerDashboard' %}">Home</a></li>
            </ol>
          </div>
        </div>
      </div>
      <!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-12 ">
          <div class="card">
            <!-- /.card-header -->
            <div class="card-body">
              <table id="example1" class="table table-bordered table-striped">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Cost</th>
                    <th>Duration</th>
                    <th>Description(s)</th>
                    <th>Status</th>
                    <th>Parter Name</th>
                    <th>Funded</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for project in projects %}
                  <tr>
                    <td>{{ project.id }}</td>
                    <td>{{ project.name }}</td>
                    <td>{{ project.cost }}</td>
                    <td>{{ project.duration }}</td>
                    <td>{{ project.discription }}</td>
                    <td>{{ project.status }}</td>
                    <td>{{ project.partnerName }}</td>
                    <td>{{ project.funded }}</td>
                    <td class="justify-content-center">
                     {% if project.funded %}
                     <a href="#" class="btn btn-secondary btn-sm edit-btn" aria-disabled="true" style="cursor: default;">
                       <i class="fas fa-pen"></i> Fund project
                     </a>
                     {% else %}
                     <a href="#" class="btn btn-info btn-sm edit-btn" 
                     data-id="1"
                     data-name="dummy"
                     data-cost="234505000"
                     data-toggle="modal"
                     data-target="#fundProjectModal">
                       <i class="fas fa-pen"></i> Fund project
                     </a>
                     {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
                <tfoot></tfoot>
              </table>
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->

      <!-- funded projects by partner start -->
      <div class="row mt-2 justify-content-center align-items-center">
       <div class="col-12 " >
        <div class="card mb-2 mt-1">
          <div class="card-header text-white" style="background-color: #6c757d;">
              <h4 class="text-white">Projects You Have Funded</h4>
          </div>
          <div class="card-body">
              {% if installments %}
                  <div class="list-group">
                      {% for installment in installments %}
                          <div class="list-group-item mb-3" style="border: 1px solid #e0e0e0; border-radius: 5px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                              
                              <P class="card-text text-info" style="font-size: 18px;">
                                Title:
                                <span>{{ installment.projectName }}</span>
                              </P>
                              <p class="card-text" style="font-size: 16px;">Payment Reference: {{ installment.payment_Ref }}</p>
                              <p class="card-text" style="font-size: 16px;">Payment Phases: {{ installment.total_installments }}</p>
                              <p class="card-text" style="font-size: 16px;">Project Cost: {{ installment.projectCost }}</p>
                              <p class="card-text" style="font-size: 16px;">Amount Paid: {{ installment.paid }}</p>
                              <p class="card-text" style="font-size: 16px;">Pending Amount: {{ installment.remainAmount }}</p>
                              {% if installment.status == 'Pending' %}
                                  <p class="card-text"style="font-size: 14px;" >Status :
                                    <span class="bg-danger" style="border: #dddfe0 0.01rem  solid; max-width: fit-content; height: 30px;padding: 0.5rem; border-radius: 0.3rem;">{{ installment.status }}</span>
                                  </p>
                              {% elif installment.status == 'PartialyPaid' %}
                              <p class="card-text" style="font-size: 14px;">Status :
                                <span class="bg-info" style="border: #dddfe0 0.01rem  solid; max-width: fit-content; height: 30px;padding: 0.5rem; border-radius: 0.3rem;">{{ installment.status }}</span>
                              </p>
                              {% else %}
                              <p class="card-text" style="font-size: 14px;" >Status :
                                <span class="bg-success" style="border: #dddfe0 0.01rem  solid; max-width: fit-content; height: 30px;padding: 0.5rem; border-radius: 0.4rem;">{{ installment.status }}</span>
                              </p>
                              {% endif %}
                          </div>
                      {% endfor %}
                  </div>
              {% else %}
                  <p class="text-muted" style="font-size: 16px;">
                      Currently there are no projects you have funded.
                  </p>
              {% endif %}
          </div>
        </div>
       </div>
    </div>
    
      <!-- funded projects by partner end here -->
    </section>
    <!-- /.content -->
  </div>

  <footer class="main-footer">
    <div class="float-right d-none d-sm-block"><b>2023</b></div>
    <strong>Copyright &copy; Dar es salaam regional commission.</strong> All rights reserved.
  </footer>


</div>
<!-- fund Project Modal -->
<div class="modal fade" id="fundProjectModal" tabindex="-1" role="dialog" aria-labelledby="fundProjectModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="fundProjectModalLabel">Fund Project</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="fundProjectForm">
          <div class="form-group">
            <label for="projectName">Project Name</label>
            <input type="text" class="form-control" id="projectName" name="projectName" readonly>
          </div>
          <div class="form-group">
            <label for="projectCost">Project Cost</label>
            <input type="number" class="form-control" id="projectCost" name="projectCost" readonly>
          </div>
          <div class="form-group">
            <label for="installments">Number of Installments</label>
            <input type="number" class="form-control" id="installments" name="installments" min="1" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" form="fundProjectForm">Save changes</button>
      </div>
    </div>
  </div>
</div>


{% if messages %}
<script>
  var messages = [];
</script>
{% for message in messages %}
<script>
  messages.push({
    "message": "{{ message.message }}",
    "tag": "{{ message.tags }}"
  });
</script>
{% endfor %}
{% endif %}

<script>
  $(function() {
    messages.forEach(function(message) {
      if (message.tag === "success") {
        toastr.success(message.message);
      } else if (message.tag === "error") {
        toastr.error(message.message);
      } else {
        toastr.info(message.message);
      }
    });

  });
  $(".edit-btn").click(function(){
    var id = $(this).data("id");
        var name = $(this).data("name");
        var cost = $(this).data("cost");

    $("#projectName").val(name);
    $("#projectCost").val(cost)


  });
  
</script>


{% endblock %}
